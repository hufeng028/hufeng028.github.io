<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://hufeng028.github.io</id>
    <title>一念觀心</title>
    <updated>2020-07-04T11:27:22.074Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://hufeng028.github.io"/>
    <link rel="self" href="https://hufeng028.github.io/atom.xml"/>
    <subtitle>凡事有交代，件件有着落，事事有回音。</subtitle>
    <logo>https://hufeng028.github.io/images/avatar.png</logo>
    <icon>https://hufeng028.github.io/favicon.ico</icon>
    <rights>All rights reserved 2020, 一念觀心</rights>
    <entry>
        <title type="html"><![CDATA[01 | 基础架构：一条SQL查询语句是如何执行的？]]></title>
        <id>https://hufeng028.github.io/01-or-ji-chu-jia-gou-yi-tiao-sql-cha-xun-yu-ju-shi-ru-he-zhi-xing-de/</id>
        <link href="https://hufeng028.github.io/01-or-ji-chu-jia-gou-yi-tiao-sql-cha-xun-yu-ju-shi-ru-he-zhi-xing-de/">
        </link>
        <updated>2020-07-04T08:57:53.000Z</updated>
        <content type="html"><![CDATA[<h3 id="mysql-的各个功能模块中的执行过程">MySQL 的各个功能模块中的执行过程</h3>
<figure data-type="image" tabindex="1"><img src="https://hufeng028.github.io/post-images/1593853520700.png" alt="" loading="lazy"></figure>
<p>MySQL可以分为Server层和存储引擎两部分。<br>
<strong>Server层包括：</strong> 连接器、查询缓存、分析器、优化器、执行器。</p>
<blockquote>
<p>大多数核心服务功能，所有内置函数（如：日期、时间、数学和加密函数等），所有跨存储引擎的功能（如：存储过程、触发器、视图等）都在这一层实现。</p>
</blockquote>
<p><strong>存储引擎层</strong>负责数据的存储和提取。插件式架构模式，支持InnoDB、MyISAM、Memory等。</p>
<h3 id="连接器">连接器</h3>
<p>连接器负责跟客户端建立连接、获取权限和管理连接。</p>
<pre><code class="language-mysql">mysql -h$ip -P$port -u$user -p
</code></pre>
<p>使用<code>show processlist</code>命令查看连接状态<br>
<img src="https://hufeng028.github.io/post-images/1593859458274.png" alt="" loading="lazy"></p>
<ul>
<li>Command列，显示为“Sleep”表示系统里有一个空闲连接</li>
<li>参数<code>wait_timeout</code>控制客户端无操作，超时自动断开时间，默认8小时</li>
</ul>
<p>尽量减少建立连接动作，尽量使用长连接。<br>
连接断开时才会释放内存，长连接累积可能导致内存占用太大，被系统强行杀掉（OOM），MySQL异常重启。解决方案：</p>
<ol>
<li>定期断开长连接</li>
<li>MySQL 5.7+，执行<code>mysql_reset_connection</code>初始化链接资源，恢复到创建时的状态（不需要重连和权限验证）</li>
</ol>
<h3 id="查询缓存">查询缓存</h3>
<p>查询请求，先查缓存，命中直接返回缓存数据，否则执行查询语句并将结果以key-value形式缓存在内存中。</p>
<blockquote>
<p>由于查询缓存失效非常频繁，弊大于利，建议不要使用。MySQL 8.0直接将查询缓存功能删掉了。</p>
</blockquote>
<h3 id="分析器">分析器</h3>
<p>分析器先做“词法分析”，再做“语法分析”</p>
<pre><code class="language-mysql">mysql&gt; elect * from t where ID=1;

ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near 'elect * from t where ID=1' at line 1
</code></pre>
<blockquote>
<p>一般语法错误会提示第一个出现错误的位置，关注紧接“user near”的内容。</p>
</blockquote>
]]></content>
    </entry>
</feed>